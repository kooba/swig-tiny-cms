<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>Eidt {{ contentId }}</title>

  <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/bootstrap-markdown/2.2.1/css/bootstrap-markdown.min.css">
  <link rel="stylesheet" href="http://yandex.st/highlightjs/8.0/styles/github.min.css">

  <style>
    body {
      padding: 10px 10px 10px 10px;
      height: 100%;
    }

    .tinycms-editor-container .btn-toolbar {
      margin-left: 0;
    }

    .tinycms-editor-container {
      width: 50%;
      float: left;
      background-color: red;
      height: 100%;
    }

    .tinycms-editor {
      padding: 10px;
    }

    .tinycms-preview {
      width: 50%;
      float: left;
      padding: 20px 10px 10px 10px;
    }

  </style>

</head>
<body>
<div>
  <div class="tinycms-editor-container">
    <form action="/{{ swigCmsRoute }}/save/" method="post" id="mainForm">
      <div>
        <input type="hidden" name="contentId" value="{{ contentId }}"/>
        <input type="hidden" name="returnUrl" value="{{ returnUrl }}"/>
        <textarea class="form-control tinycms-editor" style="padding: 10px;" rows="40" name="content" id="content">{{ content }}</textarea>
      </div>
    </form>
  </div>
  <div id="preview" class="tinycms-preview"></div>
</div>

<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js" type="text/javascript"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/marked/0.3.2/marked.min.js"></script>
<script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/bootstrap-markdown/2.2.1/js/bootstrap-markdown.min.js"></script>
<script src="http://yandex.st/highlightjs/8.0/highlight.min.js"></script>
<script>

  var editor = function (input, preview) {
    preview.html(marked(input.val()));
    var blocks = document.querySelectorAll('pre code');
    Array.prototype.forEach.call(blocks, hljs.highlightBlock);
  };

  $(function () {

    var content = $("#content");
    var preview = $("#preview");

    content.markdown({
      additionalButtons: [
        [{
          name: "groupCustom",
          data: [{
            name: "cmdSave",
            toggle: true,
            title: "Save",
            btnText: 'Save',
            btnClass: 'btn btn-primary btn-sm',
            callback: function(e){
              $('#mainForm').submit();
            }
          }]
        }]
      ]
    });

    $(":button[title='Preview']").hide();

    content.on('focus input propertychange', function () {
      editor(content,preview);
    });

    editor(content,preview);

  });
</script>
</body>
</html>